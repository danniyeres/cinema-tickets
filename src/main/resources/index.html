<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∏–Ω–æ ‚Äî Vue —Ñ—Ä–æ–Ω—Ç</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        button { margin-top: 5px; }
        form { margin-top: 20px; }
        input { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
<div id="app">
    <h1>–°–µ–∞–Ω—Å—ã —Ñ–∏–ª—å–º–æ–≤</h1>

    <ul>
        <li v-for="s in sessions" :key="s.id">
            üé¨ <b>{{ s.movie.title }}</b> ‚Äî –∑–∞–ª: {{ s.hall.name }}
            <br>
            üïí {{ s.startTime }} | üí∞ {{ s.price }} ‚Ç∏
            <div>
                <button @click="selectSession(s.id)">–ü–æ–∫–∞–∑–∞—Ç—å –±—Ä–æ–Ω–∏</button>
            </div>
        </li>
    </ul>

    <div v-if="selectedSessionId">
        <h2>–ë—Ä–æ–Ω–∏ –¥–ª—è —Å–µ—Å—Å–∏–∏ #{{ selectedSessionId }}</h2>
        <ul>
            <li v-for="b in bookings" :key="b.id">
                –ú–µ—Å—Ç–æ: {{ b.seatId }} ‚Äî {{ b.customerName }} ({{ b.customerEmail }})
            </li>
        </ul>

        <h3>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç</h3>
        <form @submit.prevent="bookTicket">
            <input v-model="booking.customerName" placeholder="–ò–º—è" required>
            <input v-model="booking.customerEmail" placeholder="Email" required>
            <input v-model.number="booking.seatId" placeholder="ID –º–µ—Å—Ç–∞" required>
            <button type="submit">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </form>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                sessions: [],
                bookings: [],
                selectedSessionId: null,
                booking: { customerName: '', customerEmail: '', seatId: null }
            };
        },
        methods: {
            async loadSessions() {
                try {
                    const res = await axios.get('http://localhost:8080/api/sessions/all');
                    this.sessions = res.data;
                } catch (err) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–µ–∞–Ω—Å–æ–≤:", err);
                }
            },
            async selectSession(id) {
                this.selectedSessionId = id;
                try {
                    const res = await axios.get(`http://localhost:8080/api/bookings/session/${id}`);
                    this.bookings = res.data;
                } catch (err) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±—Ä–æ–Ω–µ–π:", err);
                }
            },
            async bookTicket() {
                try {
                    const req = {
                        sessionId: this.selectedSessionId,
                        seatId: this.booking.seatId,
                        customerName: this.booking.customerName,
                        customerEmail: this.booking.customerEmail
                    };
                    await axios.post('http://localhost:8080/api/bookings', req);
                    alert("–ë–∏–ª–µ—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω!");
                    this.selectSession(this.selectedSessionId); // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–µ–π
                } catch (err) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏:", err);
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç");
                }
            }
        },
        mounted() {
            this.loadSessions();
        }
    }).mount('#app');
</script>
</body>
</html>
